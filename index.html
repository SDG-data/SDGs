<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <script src="/d3.v3.min.js" charset="utf-8"></script>
 </head>
  <body>
    <div id="body">
      <ul id="sdgList"></ul> 
      <div id="footer">
        List, search and visualize the SDGs. 
        <div class="hint">click or option-click to expand or collapse</div>
      </div>
    </div>
    <script type="text/javascript">

//Read Goals, Targets and Indicators
var sdgs=[]

files = ["goals","targets","indicators"];
files.forEach(function (f) {
  console.log("Loading "+f);
  d3.json(f+".json", function (error, data) {
    //for (var attrname in data) { sdgs[attrname] = data[attrname]; }
    sdgs.push(data);
    if (sdgs.length==3) { data_loaded(sdgs); }
  });
});

function data_loaded(sdgs){
  console.log(sdgs);
  list_goals(sdgs);
  add_targets(sdgs);
}
function list_goals(sdgs){
  var sdgList = document.getElementById("sdgList"); 
  var goals=sdgs[0]["goals"];
  for (var i in goals){
    var goal= goals[i];
    append_li(sdgList,"goal-"+goal["goal"],goal["goal"]+": "+goal["title"]);
  }
}

function append_li(hookElement,id,value){
  var newListItem = document.createElement("li");
  newListItem.setAttribute("id", id);
  var ListValue = document.createTextNode(value);
  newListItem.appendChild(ListValue);
  hookElement.appendChild(newListItem);
}

function add_targets(sdgs){
  var targets=sdgs[1]["targets"];
  for (var i in targets){
    var target=targets[i]; 
    console.log(target);
    var goalLi = document.getElementById("goal-"+target["goal"]);
    if (goalLi.childElementCount == 0) {
      console.log("adding ol");
      var nestedOl = document.createElement("ul");
      nestedOl.setAttribute("id", "goal-"+target["goal"]+"-ul");
      goalLi.appendChild(nestedOl);
    }else{
      var goalLiUl = document.getElementById("goal-"+target["goal"]+"-ul");
      append_li(goalLiUl,"target-"+target["id"],target["id"]+": "+target["title"]);
    }
  }
}

    </script>
  </body>
</html>


